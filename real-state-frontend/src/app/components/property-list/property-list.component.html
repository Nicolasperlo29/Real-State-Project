<div class="properties-section">
    <!-- Barra de Filtros -->
    <div class="filters-container">
        <div class="filters-header">
            <h2 class="filters-title">
                Propiedades
            </h2>
            <button class="reset-btn" (click)="resetFilters()"
                *ngIf="selectedType !== 'todos' || searchTerm || minPrice > 0 || maxPrice > 0">
                <i class="fa-solid fa-rotate-right"></i>
                Limpiar filtros
            </button>
        </div>

        <!-- Barra de b√∫squeda -->
        <div class="search-bar">
            <i class="fa-solid fa-search search-icon"></i>
            <input type="text" class="search-input" placeholder="Buscar por t√≠tulo, ubicaci√≥n o ciudad..."
                [(ngModel)]="searchTerm" />
        </div>

        <div class="filters-grid">
            <!-- Filtro por tipo -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fa-solid fa-building"></i>
                    Tipo de propiedad
                </label>
                <select class="filter-select" [(ngModel)]="selectedType">
                    <option value="todos">Todas</option>
                    <option *ngFor="let type of propertyTypes" [value]="type">{{ type }}</option>
                </select>
            </div>

            <!-- Filtro por ordenamiento -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fa-solid fa-sort"></i>
                    Ordenar por
                </label>
                <select class="filter-select" [(ngModel)]="selectedSort">
                    <option value="reciente">M√°s recientes</option>
                    <option value="precio-asc">Precio: menor a mayor</option>
                    <option value="precio-desc">Precio: mayor a menor</option>
                    <option value="area-desc">Mayor superficie</option>
                </select>
            </div>

            <!-- Filtro precio m√≠nimo -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fa-solid fa-dollar-sign"></i>
                    Precio m√≠nimo
                </label>
                <input type="number" class="filter-input" placeholder="USD 0" [(ngModel)]="minPrice" min="0" />
            </div>

            <!-- Filtro precio m√°ximo -->
            <div class="filter-group">
                <label class="filter-label">
                    <i class="fa-solid fa-dollar-sign"></i>
                    Precio m√°ximo
                </label>
                <input type="number" class="filter-input" placeholder="USD 999,999" [(ngModel)]="maxPrice" min="0" />
            </div>
        </div>
    </div>

    <!-- Lista de propiedades (horizontales) -->
    <div class="property-list" *ngIf="filteredProperties.length > 0">
        <div *ngFor="let property of paginatedProperties" class="property-card-horizontal"
            [routerLink]="['/property', property.id]">
            <div class="property-image-container">
                <img *ngIf="property.images.length > 0" [src]="property.images[property.currentImageIndex || 0].url"
                    class="property-image" />

                <div class="property-type-badge">{{ property.type }}</div>
                @if (loggedIn) {
                <button class="favorite-btn" [class.active]="isFavorite(property.id)"
                    (click)="toggleFavorite(property.id); $event.stopPropagation()"
                    [title]="isFavorite(property.id) ? 'Eliminar de favoritos' : 'Agregar a favoritos'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor"
                        stroke-width="2">
                        <path
                            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z">
                        </path>
                    </svg>
                </button>
                }

                <button class="arrow left" (click)="prevImage(property); $event.stopPropagation()"
                    *ngIf="property.images.length > 1">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>
                <button class="arrow right" (click)="nextImage(property); $event.stopPropagation()"
                    *ngIf="property.images.length > 1">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>

                <div class="image-indicator" *ngIf="property.images.length > 1">
                    {{ (property.currentImageIndex || 0) + 1 }} / {{ property.images.length }}
                </div>
            </div>

            <div class="property-details">
                <div class="property-header">
                    <h2 class="property-title">{{ property.title }}</h2>
                    <p class="property-price">USD {{ property.price | number:'1.0-0' }}</p>
                </div>

                <p class="property-location">
                    <i class="fa-solid fa-location-dot"></i>
                    <span> {{ property.address }}, {{ property.city }}</span>
                </p>

                <p class="property-location">
                    {{property.description}}
                </p>

                <div class="property-divider"></div>

                <div class="property-info">
                    <span class="property-info-item">
                        <i class="fa-solid fa-house"></i>
                        <span> {{ property.areaCubierta }}m¬≤ cubiertos</span>
                    </span>
                    <span class="property-info-item" *ngIf="property.areaTotal > 0">
                        <i class="fa-solid fa-maximize"></i>
                        <span> {{ property.areaTotal }}m¬≤ totales</span>
                    </span>
                    <span class="property-info-item">
                        <i class="fa-solid fa-bed"></i>
                        <span> {{ property.rooms }} dormitorios</span>
                    </span>
                    <span class="property-info-item">
                        <i class="fa-solid fa-bath"></i>
                        <span> {{ property.bathrooms }} ba√±os</span>
                    </span>
                </div>

                <div style="display: flex; gap: 10px; justify-content: end;">
                    <a [routerLink]="['/property', property.id]" class="view-details-button"
                        style="background-color: orangered;">
                        Contactar
                    </a>
                    <a [routerLink]="['/property', property.id]" class="view-details-button"
                        style="background-color: green;">
                        Whatsapp
                    </a>
                    <a [routerLink]="['/property', property.id]" class="view-details-button" style="color: black;">
                        üìû Llamar
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Controles de paginaci√≥n -->
    <div class="pagination-container" *ngIf="totalPages > 0">
        <button (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">
            ‚Üê Anterior
        </button>

        <span class="pagination-info">
            P√°gina {{ currentPage }} de {{ totalPages }}
        </span>

        <button (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">
            Siguiente ‚Üí
        </button>
    </div>


    <!-- Estado vac√≠o -->
    <div class="empty-state" *ngIf="filteredProperties.length === 0 && !isLoading">
        <div class="empty-icon">
            <i class="fa-solid fa-heart-crack"></i>
        </div>
        <h3 class="empty-title">No se encontraron propiedades</h3>
        <p class="empty-description">
            <span *ngIf="searchTerm || selectedType !== 'todos' || minPrice > 0 || maxPrice > 0">
                Intenta ajustar los filtros para ver m√°s resultados
            </span>
            <span *ngIf="!searchTerm && selectedType === 'todos' && minPrice === 0 && maxPrice === 0">
                A√∫n no tienes propiedades en tus favoritos
            </span>
        </p>
        <button class="empty-button" (click)="resetFilters()"
            *ngIf="searchTerm || selectedType !== 'todos' || minPrice > 0 || maxPrice > 0">
            <i class="fa-solid fa-rotate-right"></i>
            Limpiar filtros
        </button>
        <button class="empty-button"
            *ngIf="!searchTerm && selectedType === 'todos' && minPrice === 0 && maxPrice === 0">
            <i class="fa-solid fa-search"></i>
            Explorar propiedades
        </button>
    </div>
</div>